<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理 | GREETINGS, MORTAL</title>
<meta name=keywords content="Docker,邮件"><meta name=description content='配置Docker Mailserver
下载配置文件，要对docker-compose.yml稍作修改，添加邮件中继。
DMS_GITHUB_URL=&#39;https://raw.githubusercontent.com/docker-mailserver/docker-mailserver/master&#39;
wget "${DMS_GITHUB_URL}/docker-compose.yml"
wget "${DMS_GITHUB_URL}/mailserver.env"
# wget "${DMS_GITHUB_URL}/setup.sh"
# chmod a+x ./setup.sh
完整配置文件如下，其中<>内的信息自行替换，mailserver.env为之前下载的原始文件，没有修改。'><meta name=author content="AK"><link rel=canonical href=https://chenry-me.github.io/posts/how-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail/><meta name=google-site-verification content="b3qj8baX9ftQhket4rD15Qm2JWT53AQHzxN1GYHhYm4"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://chenry-me.github.io/images/logo/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://chenry-me.github.io/images/logo/favicon-96x96.png><link rel=icon type=image/png sizes=32x32 href=https://chenry-me.github.io/images/logo/favicon-96x96.png><link rel=apple-touch-icon href=https://chenry-me.github.io/images/logo/apple-touch-icon.png><link rel=mask-icon href=https://chenry-me.github.io/images/logo/favicon.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://chenry-me.github.io/posts/how-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理"><meta property="og:description" content='配置Docker Mailserver
下载配置文件，要对docker-compose.yml稍作修改，添加邮件中继。
DMS_GITHUB_URL=&#39;https://raw.githubusercontent.com/docker-mailserver/docker-mailserver/master&#39;
wget "${DMS_GITHUB_URL}/docker-compose.yml"
wget "${DMS_GITHUB_URL}/mailserver.env"
# wget "${DMS_GITHUB_URL}/setup.sh"
# chmod a+x ./setup.sh
完整配置文件如下，其中<>内的信息自行替换，mailserver.env为之前下载的原始文件，没有修改。'><meta property="og:type" content="article"><meta property="og:url" content="https://chenry-me.github.io/posts/how-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail/"><meta property="og:image" content="https://chenry-me.github.io/images/avatar.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-24T16:05:30+08:00"><meta property="article:modified_time" content="2022-12-24T16:05:30+08:00"><meta property="og:site_name" content="GREETINGS, MORTAL"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://chenry-me.github.io/images/avatar.jpg"><meta name=twitter:title content="如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理"><meta name=twitter:description content='配置Docker Mailserver
下载配置文件，要对docker-compose.yml稍作修改，添加邮件中继。
DMS_GITHUB_URL=&#39;https://raw.githubusercontent.com/docker-mailserver/docker-mailserver/master&#39;
wget "${DMS_GITHUB_URL}/docker-compose.yml"
wget "${DMS_GITHUB_URL}/mailserver.env"
# wget "${DMS_GITHUB_URL}/setup.sh"
# chmod a+x ./setup.sh
完整配置文件如下，其中<>内的信息自行替换，mailserver.env为之前下载的原始文件，没有修改。'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://chenry-me.github.io/posts/"},{"@type":"ListItem","position":2,"name":"如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理","item":"https://chenry-me.github.io/posts/how-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理","name":"如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理","description":"配置Docker Mailserver 下载配置文件，要对docker-compose.yml稍作修改，添加邮件中继。\nDMS_GITHUB_URL=\u0026#39;https://raw.githubusercontent.com/docker-mailserver/docker-mailserver/master\u0026#39; wget \u0026#34;${DMS_GITHUB_URL}/docker-compose.yml\u0026#34; wget \u0026#34;${DMS_GITHUB_URL}/mailserver.env\u0026#34; # wget \u0026#34;${DMS_GITHUB_URL}/setup.sh\u0026#34; # chmod a+x ./setup.sh 完整配置文件如下，其中\u0026lt;\u0026gt;内的信息自行替换，mailserver.env为之前下载的原始文件，没有修改。\n","keywords":["Docker","邮件"],"articleBody":"配置Docker Mailserver 下载配置文件，要对docker-compose.yml稍作修改，添加邮件中继。\nDMS_GITHUB_URL='https://raw.githubusercontent.com/docker-mailserver/docker-mailserver/master' wget \"${DMS_GITHUB_URL}/docker-compose.yml\" wget \"${DMS_GITHUB_URL}/mailserver.env\" # wget \"${DMS_GITHUB_URL}/setup.sh\" # chmod a+x ./setup.sh 完整配置文件如下，其中\u003c\u003e内的信息自行替换，mailserver.env为之前下载的原始文件，没有修改。\n如果是裸域安装，就在hostname内直接填写.。\n手动配置ssl，调用服务器配置的ssl文件，其他方法参考官方文档。\n为避免垃圾邮件泛滥，大部分服务器提供商通常会封锁 25 端口出站流量，不能直接发邮件，因此配置Mailgun作为邮件中继发件。\n第26行和第29、30行证书位置自行替换为对应位置。\n自签名证书直接套用此配置会报错，需另外配置，可去官方文档自行查询。\nversion: \"3\" services: mailserver: image: mailserver/docker-mailserver:11.3.1 container_name: mailserver # If the FQDN for your mail-server is only two labels (eg: example.com), # you can assign this entirely to `hostname` and remove `domainname`. hostname: domainname: . env_file: mailserver.env # More information about the mail-server ports: # https://docker-mailserver.github.io/docker-mailserver/edge/config/security/understanding-the-ports/ # To avoid conflicts with yaml base-60 float, DO NOT remove the quotation marks. ports: - \"25:25\" # SMTP (explicit TLS =\u003e STARTTLS) - \"143:143\" # IMAP4 (explicit TLS =\u003e STARTTLS) - \"465:465\" # ESMTP (implicit TLS) - \"587:587\" # ESMTP (explicit TLS =\u003e STARTTLS) - \"993:993\" # IMAP4 (implicit TLS) volumes: - ./mail-data/:/var/mail/ - ./mail-state/:/var/mail-state/ - ./mail-logs/:/var/log/mail/ - ./config/:/tmp/docker-mailserver/ - /etc/localtime:/etc/localtime:ro - /etc/nginx/ssl/:/etc/letsencrypt/:ro environment: - SSL_TYPE=manual - SSL_CERT_PATH=/etc/letsencrypt/certs/.cer - SSL_KEY_PATH=/etc/letsencrypt/private/.key - ENABLE_SPAMASSASSIN=1 - ENABLE_FAIL2BAN=1 - POSTFIX_MESSAGE_SIZE_LIMIT=20971520 # 20M - UPDATE_CHECK_INTERVAL=7d - RELAY_HOST=smtp.mailgun.org - RELAY_PORT=587 - RELAY_USER= - RELAY_PASSWORD= restart: always stop_grace_period: 1m healthcheck: test: \"ss --listening --tcp | grep -P 'LISTEN.+:smtp' || exit 1\" timeout: 3s retries: 1 15-mailboxes.conf为自定义邮箱文件夹配置，主要添加了存档文件夹，放在”./config/dovecot”下，也可以自行修改。\n## ## Mailbox definitions ## # Each mailbox is specified in a separate mailbox section. The section name # specifies the mailbox name. If it has spaces, you can put the name # \"in quotes\". These sections can contain the following mailbox settings: # # auto: # Indicates whether the mailbox with this name is automatically created # implicitly when it is first accessed. The user can also be automatically # subscribed to the mailbox after creation. The following values are # defined for this setting: # # no - Never created automatically. # create - Automatically created, but no automatic subscription. # subscribe - Automatically created and subscribed. # # special_use: # A space-separated list of SPECIAL-USE flags (RFC 6154) to use for the # mailbox. There are no validity checks, so you could specify anything # you want in here, but it's not a good idea to use flags other than the # standard ones specified in the RFC: # # \\All - This (virtual) mailbox presents all messages in the # user's message store. # \\Archive - This mailbox is used to archive messages. # \\Drafts - This mailbox is used to hold draft messages. # \\Flagged - This (virtual) mailbox presents all messages in the # user's message store marked with the IMAP \\Flagged flag. # \\Important - This (virtual) mailbox presents all messages in the # user's message store deemed important to user. # \\Junk - This mailbox is where messages deemed to be junk mail # are held. # \\Sent - This mailbox is used to hold copies of messages that # have been sent. # \\Trash - This mailbox is used to hold messages that have been # deleted. # # comment: # Defines a default comment or note associated with the mailbox. This # value is accessible through the IMAP METADATA mailbox entries # \"/shared/comment\" and \"/private/comment\". Users with sufficient # privileges can override the default value for entries with a custom # value. # NOTE: Assumes \"namespace inbox\" has been defined in 10-mail.conf. namespace inbox { # These mailboxes are widely used and could perhaps be created automatically: mailbox Drafts { auto = subscribe special_use = \\Drafts } mailbox Junk { auto = subscribe special_use = \\Junk } mailbox Trash { auto = subscribe special_use = \\Trash } # For \\Sent mailboxes there are two widely used names. We'll mark both of # them as \\Sent. User typically deletes one of them if duplicates are created. mailbox Sent { auto = subscribe special_use = \\Sent } #mailbox \"Sent Messages\" { # special_use = \\Sent #} mailbox Archive { auto = subscribe special_use = \\Archive } # If you have a virtual \"All messages\" mailbox: #mailbox virtual/All { # special_use = \\All # comment = All my messages #} # If you have a virtual \"Flagged\" mailbox: #mailbox virtual/Flagged { # special_use = \\Flagged # comment = All my flagged messages #} # If you have a virtual \"Important\" mailbox: #mailbox virtual/Important { # special_use = \\Important # comment = All my important messages #} } 配置DNS和防火墙 DNS配置 裸域安装是没有必要的，无论是不是裸域，邮件后缀@.都能够收到。\n但是裸域安装要在”./config”文件夹下添加配置文件”postfix-main.cf”，加入以下内容，官方文档有写。\nmydestination = localhost.$mydomain, localhost 关键在于MX解析的配置。\n以邮件服务器域名为mail..为例，配置A解析mail到服务器ip地址，配置MX解析 .到mail..，优先级设置为10，这样就保证了发往@.的邮件能够到达。\n生成DKIM等配置由于采用了邮件中继，因此直接使用邮件中继提供的内容即可，无需自行配置。以Mailgun为例，位于Sending \u003e Domain settings \u003e DNS records处。添加这些DNS记录是较为必要的，保证了邮件的送达率。\n注意，MX记录不要按照Mailgun给出的配置，其配置将收件指向Mailgun。\n防火墙 防火墙方面，25 端口需要开放才能收到邮件。143 端口为未加密IMAP，可以不开放。465 端口和 587 端口为加密SMTP端口，建议开放。993 端口为加密IMAP端口，建议开放。\n用户管理 这里列出了创建用户，添加别名，设置邮件配额的基本方法。\n# 添加用户 docker exec -it mailserver setup email add @. # 创建用户别名 docker exec -it mailserver setup alias add @. @. # 设置邮件配额 docker exec -it mailserver setup quota set @. 2G 更详细的内容自行查看官方文档。\n小插曲 使用一段时间后我查看log，发现有个ip一直在尝试破解登录我的邮箱，尝试了不同的用户名。遇到这样的情况，我们可以使用内置的fail2ban工具手动ban掉他的ip。\n启用/重启fail2ban工具。\ndocker exec -it mailserver supervisorctl restart fail2ban Ban掉指定ip地址。\ndocker exec -it mailserver setup fail2ban ban 45.128.234.165 # 取消禁令 # docker exec -it mailserver setup fail2ban unban 45.128.234.165 安装Roundcube Webmail roundcube是一个网络邮件客户端，可以通过如下配置文件安装。\n假定Docker Mailserver服务器的域名为mail..。\n在环境中指定IMAP和SMTP端口，设置附件最大文件大小。也可采用mysql等数据库作为后端，但不是特别必要。根据需要更改以下yaml文件的服务器端口。\nversion: '3' services: roundcube: image: roundcube/roundcubemail:1.6.x-apache container_name: roundcube restart: unless-stopped volumes: - ./data:/var/www/html - ./db/sqlite:/var/roundcube/db - ./config:/var/roundcube/config ports: - \"80:80\" environment: - ROUNDCUBEMAIL_DB_TYPE=sqlite - ROUNDCUBEMAIL_SKIN=elastic - ROUNDCUBEMAIL_DEFAULT_HOST=ssl://mail.. - ROUNDCUBEMAIL_DEFAULT_PORT=993 - ROUNDCUBEMAIL_SMTP_SERVER=ssl://mail.. - ROUNDCUBEMAIL_SMTP_PORT=465 - ROUNDCUBEMAIL_UPLOAD_MAX_FILESIZE=20M 配置Apache2或Nginx等http服务器通过SSL反向代理到端口是更安全的。这里给出一个Nginx的例子，按照实际情况修改。\nserver { listen 80; listen [::]:80; server_name ..; return 301 https://$server_name$request_uri; } server { listen 443 ssl; listen [::]:443 ssl; server_name ..; client_max_body_size 20m; ssl_certificate /etc/nginx/ssl/certs/*..-fullchain.cer; ssl_certificate_key /etc/nginx/ssl/private/*...key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:/; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection 'upgrade'; proxy_cache_bypass $http_upgrade; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } access_log /var/log/nginx/webmail.access.log; error_log /var/log/nginx/webmail.error.log; } 一些链接 docker-mailserver官方文档：https://docker-mailserver.github.io/docker-mailserver/v10.0/introduction/\ndocker-mailserver托管地址：https://github.com/docker-mailserver/docker-mailserver\nroundcube-docker托管地址：https://github.com/roundcube/roundcubemail-docker\n","wordCount":"2439","inLanguage":"en","image":"https://chenry-me.github.io/images/avatar.jpg","datePublished":"2022-12-24T16:05:30+08:00","dateModified":"2022-12-24T16:05:30+08:00","author":{"@type":"Person","name":"AK"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://chenry-me.github.io/posts/how-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail/"},"publisher":{"@type":"Organization","name":"GREETINGS, MORTAL","logo":{"@type":"ImageObject","url":"https://chenry-me.github.io/images/logo/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://chenry-me.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://chenry-me.github.io/images/avatar.jpg alt aria-label=logo height=36>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://chenry-me.github.io/about/ title=关于><span>关于</span></a></li><li><a href=https://chenry-me.github.io/contact/ title=联系><span>联系</span></a></li><li><a href=https://chenry-me.github.io/privacy/ title=隐私><span>隐私</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://chenry-me.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://chenry-me.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理</h1><div class=post-meta><span title='2022-12-24 16:05:30 +0800 CST'>December 24, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;2439 words&nbsp;·&nbsp;AK&nbsp;|&nbsp;<a href=https://github.com/chenry-me/chenry-me.github.io/issues rel="noopener noreferrer" target=_blank>Issues</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#配置docker-mailserver>配置Docker Mailserver</a></li><li><a href=#配置dns和防火墙>配置DNS和防火墙</a><ul><li><a href=#dns配置>DNS配置</a></li><li><a href=#防火墙>防火墙</a></li></ul></li><li><a href=#用户管理>用户管理</a></li><li><a href=#小插曲>小插曲</a></li><li><a href=#安装roundcube-webmail>安装Roundcube Webmail</a></li><li><a href=#一些链接>一些链接</a></li></ul></nav></div></details></div><div class=post-content><h2 id=配置docker-mailserver>配置Docker Mailserver<a hidden class=anchor aria-hidden=true href=#配置docker-mailserver>#</a></h2><p>下载配置文件，要对docker-compose.yml稍作修改，添加邮件中继。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>DMS_GITHUB_URL</span><span class=o>=</span><span class=s1>&#39;https://raw.githubusercontent.com/docker-mailserver/docker-mailserver/master&#39;</span>
</span></span><span class=line><span class=cl>wget <span class=s2>&#34;</span><span class=si>${</span><span class=nv>DMS_GITHUB_URL</span><span class=si>}</span><span class=s2>/docker-compose.yml&#34;</span>
</span></span><span class=line><span class=cl>wget <span class=s2>&#34;</span><span class=si>${</span><span class=nv>DMS_GITHUB_URL</span><span class=si>}</span><span class=s2>/mailserver.env&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># wget &#34;${DMS_GITHUB_URL}/setup.sh&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># chmod a+x ./setup.sh</span>
</span></span></code></pre></div><p>完整配置文件如下，其中&lt;>内的信息自行替换，mailserver.env为之前下载的原始文件，没有修改。</p><p>如果是裸域安装，就在hostname内直接填写<code>&lt;domain>.&lt;tld></code>。</p><p>手动配置ssl，调用服务器配置的ssl文件，其他方法参考官方文档。</p><p>为避免垃圾邮件泛滥，大部分服务器提供商通常会封锁 25 端口出站流量，不能直接发邮件，因此配置Mailgun作为邮件中继发件。</p><p>第26行和第29、30行证书位置自行替换为对应位置。</p><p>自签名证书直接套用此配置会报错，需另外配置，可去官方文档自行查询。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mailserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>mailserver/docker-mailserver:11.3.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>mailserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># If the FQDN for your mail-server is only two labels (eg: example.com),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># you can assign this entirely to `hostname` and remove `domainname`.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>&lt;hostname&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>domainname</span><span class=p>:</span><span class=w> </span><span class=l>&lt;domain&gt;.&lt;tld&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span><span class=w> </span><span class=l>mailserver.env</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># More information about the mail-server ports:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># https://docker-mailserver.github.io/docker-mailserver/edge/config/security/understanding-the-ports/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># To avoid conflicts with yaml base-60 float, DO NOT remove the quotation marks.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;25:25&#34;</span><span class=w> </span><span class=c># SMTP  (explicit TLS =&gt; STARTTLS)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;143:143&#34;</span><span class=w> </span><span class=c># IMAP4 (explicit TLS =&gt; STARTTLS)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;465:465&#34;</span><span class=w> </span><span class=c># ESMTP (implicit TLS)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;587:587&#34;</span><span class=w> </span><span class=c># ESMTP (explicit TLS =&gt; STARTTLS)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;993:993&#34;</span><span class=w> </span><span class=c># IMAP4 (implicit TLS)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./mail-data/:/var/mail/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./mail-state/:/var/mail-state/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./mail-logs/:/var/log/mail/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./config/:/tmp/docker-mailserver/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/etc/localtime:/etc/localtime:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/etc/nginx/ssl/:/etc/letsencrypt/:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SSL_TYPE=manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SSL_CERT_PATH=/etc/letsencrypt/certs/&lt;cert&gt;.cer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>SSL_KEY_PATH=/etc/letsencrypt/private/&lt;private&gt;.key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ENABLE_SPAMASSASSIN=1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ENABLE_FAIL2BAN=1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTFIX_MESSAGE_SIZE_LIMIT=20971520</span><span class=w> </span><span class=c># 20M</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>UPDATE_CHECK_INTERVAL=7d</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>RELAY_HOST=smtp.mailgun.org</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>RELAY_PORT=587</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>RELAY_USER=&lt;user&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>RELAY_PASSWORD=&lt;password&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>stop_grace_period</span><span class=p>:</span><span class=w> </span><span class=l>1m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ss --listening --tcp | grep -P &#39;LISTEN.+:smtp&#39; || exit 1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>3s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span></code></pre></div><p>15-mailboxes.conf为自定义邮箱文件夹配置，主要添加了存档文件夹，放在”./config/dovecot”下，也可以自行修改。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>##
</span></span><span class=line><span class=cl>## Mailbox definitions
</span></span><span class=line><span class=cl>##
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Each mailbox is specified in a separate mailbox section. The section name
</span></span><span class=line><span class=cl># specifies the mailbox name. If it has spaces, you can put the name
</span></span><span class=line><span class=cl># &#34;in quotes&#34;. These sections can contain the following mailbox settings:
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># auto:
</span></span><span class=line><span class=cl>#   Indicates whether the mailbox with this name is automatically created
</span></span><span class=line><span class=cl>#   implicitly when it is first accessed. The user can also be automatically
</span></span><span class=line><span class=cl>#   subscribed to the mailbox after creation. The following values are
</span></span><span class=line><span class=cl>#   defined for this setting:
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>#     no        - Never created automatically.
</span></span><span class=line><span class=cl>#     create    - Automatically created, but no automatic subscription.
</span></span><span class=line><span class=cl>#     subscribe - Automatically created and subscribed.
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># special_use:
</span></span><span class=line><span class=cl>#   A space-separated list of SPECIAL-USE flags (RFC 6154) to use for the
</span></span><span class=line><span class=cl>#   mailbox. There are no validity checks, so you could specify anything
</span></span><span class=line><span class=cl>#   you want in here, but it&#39;s not a good idea to use flags other than the
</span></span><span class=line><span class=cl>#   standard ones specified in the RFC:
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>#     \All       - This (virtual) mailbox presents all messages in the
</span></span><span class=line><span class=cl>#                  user&#39;s message store.
</span></span><span class=line><span class=cl>#     \Archive   - This mailbox is used to archive messages.
</span></span><span class=line><span class=cl>#     \Drafts    - This mailbox is used to hold draft messages.
</span></span><span class=line><span class=cl>#     \Flagged   - This (virtual) mailbox presents all messages in the
</span></span><span class=line><span class=cl>#                  user&#39;s message store marked with the IMAP \Flagged flag.
</span></span><span class=line><span class=cl>#     \Important - This (virtual) mailbox presents all messages in the
</span></span><span class=line><span class=cl>#                  user&#39;s message store deemed important to user.
</span></span><span class=line><span class=cl>#     \Junk      - This mailbox is where messages deemed to be junk mail
</span></span><span class=line><span class=cl>#                  are held.
</span></span><span class=line><span class=cl>#     \Sent      - This mailbox is used to hold copies of messages that
</span></span><span class=line><span class=cl>#                  have been sent.
</span></span><span class=line><span class=cl>#     \Trash     - This mailbox is used to hold messages that have been
</span></span><span class=line><span class=cl>#                  deleted.
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># comment:
</span></span><span class=line><span class=cl>#   Defines a default comment or note associated with the mailbox. This
</span></span><span class=line><span class=cl>#   value is accessible through the IMAP METADATA mailbox entries
</span></span><span class=line><span class=cl>#   &#34;/shared/comment&#34; and &#34;/private/comment&#34;. Users with sufficient
</span></span><span class=line><span class=cl>#   privileges can override the default value for entries with a custom
</span></span><span class=line><span class=cl>#   value.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># NOTE: Assumes &#34;namespace inbox&#34; has been defined in 10-mail.conf.
</span></span><span class=line><span class=cl>namespace inbox {
</span></span><span class=line><span class=cl>  # These mailboxes are widely used and could perhaps be created automatically:
</span></span><span class=line><span class=cl>  mailbox Drafts {
</span></span><span class=line><span class=cl>    auto = subscribe
</span></span><span class=line><span class=cl>    special_use = \Drafts
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>  mailbox Junk {
</span></span><span class=line><span class=cl>    auto = subscribe
</span></span><span class=line><span class=cl>    special_use = \Junk
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>  mailbox Trash {
</span></span><span class=line><span class=cl>    auto = subscribe
</span></span><span class=line><span class=cl>    special_use = \Trash
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  # For \Sent mailboxes there are two widely used names. We&#39;ll mark both of
</span></span><span class=line><span class=cl>  # them as \Sent. User typically deletes one of them if duplicates are created.
</span></span><span class=line><span class=cl>  mailbox Sent {
</span></span><span class=line><span class=cl>    auto = subscribe
</span></span><span class=line><span class=cl>    special_use = \Sent
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  #mailbox &#34;Sent Messages&#34; {
</span></span><span class=line><span class=cl>  #  special_use = \Sent
</span></span><span class=line><span class=cl>  #}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  mailbox Archive {
</span></span><span class=line><span class=cl>   auto = subscribe
</span></span><span class=line><span class=cl>   special_use = \Archive
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  # If you have a virtual &#34;All messages&#34; mailbox:
</span></span><span class=line><span class=cl>  #mailbox virtual/All {
</span></span><span class=line><span class=cl>  #  special_use = \All
</span></span><span class=line><span class=cl>  #  comment = All my messages
</span></span><span class=line><span class=cl>  #}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  # If you have a virtual &#34;Flagged&#34; mailbox:
</span></span><span class=line><span class=cl>  #mailbox virtual/Flagged {
</span></span><span class=line><span class=cl>  #  special_use = \Flagged
</span></span><span class=line><span class=cl>  #  comment = All my flagged messages
</span></span><span class=line><span class=cl>  #}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  # If you have a virtual &#34;Important&#34; mailbox:
</span></span><span class=line><span class=cl>  #mailbox virtual/Important {
</span></span><span class=line><span class=cl>  #  special_use = \Important
</span></span><span class=line><span class=cl>  #  comment = All my important messages
</span></span><span class=line><span class=cl>  #}
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><h2 id=配置dns和防火墙>配置DNS和防火墙<a hidden class=anchor aria-hidden=true href=#配置dns和防火墙>#</a></h2><h3 id=dns配置>DNS配置<a hidden class=anchor aria-hidden=true href=#dns配置>#</a></h3><p>裸域安装是没有必要的，无论是不是裸域，邮件后缀<code>@&lt;domain>.&lt;tld></code>都能够收到。</p><p>但是裸域安装要在”./config”文件夹下添加配置文件”postfix-main.cf”，加入以下内容，官方文档有写。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>mydestination = localhost.$mydomain, localhost
</span></span></code></pre></div><p>关键在于MX解析的配置。</p><p>以邮件服务器域名为<code>mail.&lt;domain>.&lt;tld></code>为例，配置A解析mail到服务器ip地址，配置MX解析 <code>&lt;domain>.&lt;tld></code>到<code>mail.&lt;domain>.&lt;tld></code>，优先级设置为10，这样就保证了发往<code>@&lt;domain>.&lt;tld></code>的邮件能够到达。</p><p>生成DKIM等配置由于采用了邮件中继，因此直接使用邮件中继提供的内容即可，无需自行配置。以Mailgun为例，位于Sending > Domain settings > DNS records处。添加这些DNS记录是较为必要的，保证了邮件的送达率。</p><p>注意，MX记录不要按照Mailgun给出的配置，其配置将收件指向Mailgun。</p><h3 id=防火墙>防火墙<a hidden class=anchor aria-hidden=true href=#防火墙>#</a></h3><p>防火墙方面，25 端口需要开放才能收到邮件。143 端口为未加密IMAP，可以不开放。465 端口和 587 端口为加密SMTP端口，建议开放。993 端口为加密IMAP端口，建议开放。</p><h2 id=用户管理>用户管理<a hidden class=anchor aria-hidden=true href=#用户管理>#</a></h2><p>这里列出了创建用户，添加别名，设置邮件配额的基本方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 添加用户</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it mailserver setup email add &lt;user&gt;@&lt;domain&gt;.&lt;tld&gt; &lt;password&gt;
</span></span><span class=line><span class=cl><span class=c1># 创建用户别名</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it mailserver setup <span class=nb>alias</span> add &lt;alias&gt;@&lt;domain&gt;.&lt;tld&gt; &lt;user&gt;@&lt;domain&gt;.&lt;tld&gt;
</span></span><span class=line><span class=cl><span class=c1># 设置邮件配额</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it mailserver setup quota <span class=nb>set</span> &lt;user&gt;@&lt;domain&gt;.&lt;tld&gt; 2G
</span></span></code></pre></div><p>更详细的内容自行查看官方文档。</p><h2 id=小插曲>小插曲<a hidden class=anchor aria-hidden=true href=#小插曲>#</a></h2><p>使用一段时间后我查看log，发现有个ip一直在尝试破解登录我的邮箱，尝试了不同的用户名。遇到这样的情况，我们可以使用内置的fail2ban工具手动ban掉他的ip。</p><p>启用/重启fail2ban工具。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it mailserver supervisorctl restart fail2ban
</span></span></code></pre></div><p>Ban掉指定ip地址。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it mailserver setup fail2ban ban 45.128.234.165
</span></span><span class=line><span class=cl><span class=c1># 取消禁令</span>
</span></span><span class=line><span class=cl><span class=c1># docker exec -it mailserver setup fail2ban unban 45.128.234.165</span>
</span></span></code></pre></div><h2 id=安装roundcube-webmail>安装Roundcube Webmail<a hidden class=anchor aria-hidden=true href=#安装roundcube-webmail>#</a></h2><p>roundcube是一个网络邮件客户端，可以通过如下配置文件安装。</p><p>假定Docker Mailserver服务器的域名为<code>mail.&lt;domain>.&lt;tld></code>。</p><p>在环境中指定IMAP和SMTP端口，设置附件最大文件大小。也可采用mysql等数据库作为后端，但不是特别必要。根据需要更改以下yaml文件的服务器端口。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>roundcube</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>roundcube/roundcubemail:1.6.x-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>roundcube</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data:/var/www/html</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./db/sqlite:/var/roundcube/db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./config:/var/roundcube/config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;80:80&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ROUNDCUBEMAIL_DB_TYPE=sqlite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ROUNDCUBEMAIL_SKIN=elastic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ROUNDCUBEMAIL_DEFAULT_HOST=ssl://mail.&lt;domain&gt;.&lt;tld&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ROUNDCUBEMAIL_DEFAULT_PORT=993</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ROUNDCUBEMAIL_SMTP_SERVER=ssl://mail.&lt;domain&gt;.&lt;tld&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ROUNDCUBEMAIL_SMTP_PORT=465</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ROUNDCUBEMAIL_UPLOAD_MAX_FILESIZE=20M</span><span class=w>
</span></span></span></code></pre></div><p>配置Apache2或Nginx等http服务器通过SSL反向代理到端口是更安全的。这里给出一个Nginx的例子，按照实际情况修改。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>server {
</span></span><span class=line><span class=cl>    listen 80;
</span></span><span class=line><span class=cl>    listen [::]:80;
</span></span><span class=line><span class=cl>    server_name &lt;host&gt;.&lt;domain&gt;.&lt;tld&gt;;
</span></span><span class=line><span class=cl>    return 301 https://$server_name$request_uri;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>server {
</span></span><span class=line><span class=cl>    listen 443 ssl;
</span></span><span class=line><span class=cl>    listen [::]:443 ssl;
</span></span><span class=line><span class=cl>    server_name &lt;host&gt;.&lt;domain&gt;.&lt;tld&gt;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    client_max_body_size 20m;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ssl_certificate      /etc/nginx/ssl/certs/*.&lt;domain&gt;.&lt;tld&gt;-fullchain.cer;
</span></span><span class=line><span class=cl>    ssl_certificate_key  /etc/nginx/ssl/private/*.&lt;domain&gt;.&lt;tld&gt;.key;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ssl_session_cache    shared:SSL:1m;
</span></span><span class=line><span class=cl>    ssl_session_timeout  5m;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ssl_ciphers  HIGH:!aNULL:!MD5;
</span></span><span class=line><span class=cl>    ssl_prefer_server_ciphers  on;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    location / {
</span></span><span class=line><span class=cl>        proxy_pass http://127.0.0.1:&lt;port&gt;/;
</span></span><span class=line><span class=cl>        proxy_set_header Upgrade $http_upgrade;
</span></span><span class=line><span class=cl>        proxy_set_header Connection &#39;upgrade&#39;;
</span></span><span class=line><span class=cl>        proxy_cache_bypass $http_upgrade;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        proxy_set_header Host  $http_host;
</span></span><span class=line><span class=cl>        proxy_set_header X-Real-IP  $remote_addr;
</span></span><span class=line><span class=cl>        proxy_set_header X-Forwarded-For  $proxy_add_x_forwarded_for;
</span></span><span class=line><span class=cl>        proxy_set_header X-Forwarded-Proto  $scheme;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    access_log  /var/log/nginx/webmail.access.log;
</span></span><span class=line><span class=cl>    error_log   /var/log/nginx/webmail.error.log;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><h2 id=一些链接>一些链接<a hidden class=anchor aria-hidden=true href=#一些链接>#</a></h2><p>docker-mailserver官方文档：<a href=https://docker-mailserver.github.io/docker-mailserver/v10.0/introduction/>https://docker-mailserver.github.io/docker-mailserver/v10.0/introduction/</a></p><p>docker-mailserver托管地址：<a href=https://github.com/docker-mailserver/docker-mailserver>https://github.com/docker-mailserver/docker-mailserver</a></p><p>roundcube-docker托管地址：<a href=https://github.com/roundcube/roundcubemail-docker>https://github.com/roundcube/roundcubemail-docker</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://chenry-me.github.io/tags/docker/>Docker</a></li><li><a href=https://chenry-me.github.io/tags/%E9%82%AE%E4%BB%B6/>邮件</a></li></ul><nav class=paginav><a class=prev href=https://chenry-me.github.io/posts/how-to-sign-and-encrypt-emails-for-free-mailserver-advanced/><span class=title>« Prev</span><br><span>如何零成本对邮件进行签名和加密——Mailserver 进阶篇</span>
</a><a class=next href=https://chenry-me.github.io/posts/how-to-solve-the-problem-of-slow-or-failed-docker-image-downloads-in-china/><span class=title>Next »</span><br><span>如何解决国内docker镜像下载慢或失败的问题</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理 on x" href="https://x.com/intent/tweet/?text=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8Docker%20Mailserver%e6%90%ad%e5%bb%ba%e9%82%ae%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%b9%b6%e7%94%a8Roundcube%20Webmail%e7%ae%a1%e7%90%86&amp;url=https%3a%2f%2fchenry-me.github.io%2fposts%2fhow-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail%2f&amp;hashtags=Docker%2c%e9%82%ae%e4%bb%b6"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fchenry-me.github.io%2fposts%2fhow-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail%2f&amp;title=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8Docker%20Mailserver%e6%90%ad%e5%bb%ba%e9%82%ae%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%b9%b6%e7%94%a8Roundcube%20Webmail%e7%ae%a1%e7%90%86&amp;summary=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8Docker%20Mailserver%e6%90%ad%e5%bb%ba%e9%82%ae%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%b9%b6%e7%94%a8Roundcube%20Webmail%e7%ae%a1%e7%90%86&amp;source=https%3a%2f%2fchenry-me.github.io%2fposts%2fhow-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fchenry-me.github.io%2fposts%2fhow-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail%2f&title=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8Docker%20Mailserver%e6%90%ad%e5%bb%ba%e9%82%ae%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%b9%b6%e7%94%a8Roundcube%20Webmail%e7%ae%a1%e7%90%86"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fchenry-me.github.io%2fposts%2fhow-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理 on whatsapp" href="https://api.whatsapp.com/send?text=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8Docker%20Mailserver%e6%90%ad%e5%bb%ba%e9%82%ae%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%b9%b6%e7%94%a8Roundcube%20Webmail%e7%ae%a1%e7%90%86%20-%20https%3a%2f%2fchenry-me.github.io%2fposts%2fhow-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理 on telegram" href="https://telegram.me/share/url?text=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8Docker%20Mailserver%e6%90%ad%e5%bb%ba%e9%82%ae%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%b9%b6%e7%94%a8Roundcube%20Webmail%e7%ae%a1%e7%90%86&amp;url=https%3a%2f%2fchenry-me.github.io%2fposts%2fhow-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何使用Docker Mailserver搭建邮件服务器并用Roundcube Webmail管理 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8Docker%20Mailserver%e6%90%ad%e5%bb%ba%e9%82%ae%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%b9%b6%e7%94%a8Roundcube%20Webmail%e7%ae%a1%e7%90%86&u=https%3a%2f%2fchenry-me.github.io%2fposts%2fhow-to-run-your-own-mailserver-with-docker-mailserver-and-roundcube-webmail%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><div class=footer-content><div class=footer-row><a href=https://chenry-me.github.io/little-site-big-news/>小站大事记</a></div><div class=footer-row><span>© 2021 - 2025 <a href=https://chenry-me.github.io/>GREETINGS, MORTAL</a></span></div><div class=footer-row><span><a href=https://creativecommons.org/licenses/by-sa/4.0/ rel="noopener noreferrer" target=_blank>CC BY-SA 4.0</a>
· Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel="noopener noreferrer" target=_blank>PaperMod</a></span></div></div></footer><a accesskey=g aria-label="go to top" class=top-link href=#top id=top-link title="Go to Top (Alt + G)"><svg fill="currentcolor" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>